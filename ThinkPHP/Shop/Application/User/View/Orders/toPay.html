<!doctype html>
<html>
<meta name="MobileOptimized" content="240" />
<meta name="viewport" content="width=device-width; initial-scale=1.0; minimum-scale=1.0; maximum-scale=1.0" />
<head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8"/>
    <title>微信安全支付</title>

    <script type="text/javascript">
        var jsApiParameters = '{$jsApiParameters}';
        alert(jsApiParameters);
        //调用微信JS api 支付
        function jsApiCall()
        {
            WeixinJSBridge.invoke(
                    'getBrandWCPayRequest', jsApiParameters,
                    function(res){
                        WeixinJSBridge.log(res.err_msg);
                        alert(res.err_code+res.err_desc+res.err_msg);
                        alert(res.err_msg);
                        if(res.err_msg == "get_brand_wcpay_request:ok"){
                            //alert('支付成功！！！');
                            location.href="{:C('site_url')}/wx/Order_index.html";
                        }else{
                            history.back(-1);
                        }
                    }
            );
        }

        function callpay()
        {


            if (typeof WeixinJSBridge == "undefined"){


                if( document.addEventListener ){

                    document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
                }else if (document.attachEvent){

                    document.attachEvent('WeixinJSBridgeReady', jsApiCall);
                    document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
                }
            }else{
                //alert('ok3');
                jsApiCall();
            }

        }



    </script>
</head>
<body style="" onload="callpay()">
<center style="margin-top:100px;">
    <span style="color:gray;">正在处理.....</span>
</center>
<!-- <button style="width:80%; height:100px; background-color:#45c01a; border:none; cursor:pointer; cursor: pointer;  color:white;  font-size:1.4rem; position:absolute; top:50%; margin-top:-50px; left:10%; overflow:hidden; border-radius:10px;" type="button" onClick="callpay()" >立即支付</button> -->

</body>
</html>
